#include <stdio.h>
#include <stdlib.h>
#include <assert.h>
#include <string.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <sys/ioctl.h>
#include <sys/mman.h>
#include <fcntl.h>
#include <unistd.h>
#include <time.h>

#include "tool.h"

struct subcard_size sc_size;

/*********************************************K7F map BGA152-FH_0C*******************************************/
const unsigned char dev_pkg_phylun_k7f[][8+PKG_ATTR] = {
	// left front side subcard
	{0,1,4,5,8,9,12,13,HBYTE}, {2,3,6,7,10,11,14,15,HBYTE}, {64,65,68,69,72,73,76,77,LBYTE}, {66,67,70,71,74,75,78,79,LBYTE},
	{0,1,4,5,8,9,12,13,LBYTE}, {2,3,6,7,10,11,14,15,LBYTE}, {64,65,68,69,72,73,76,77,HBYTE}, {66,67,70,71,74,75,78,79,HBYTE},
	{128,129,132,133,136,137,140,141,HBYTE}, {130,131,134,135,138,139,142,143,HBYTE}, {192,193,196,197,200,201,204,205,LBYTE}, {194,195,198,199,202,203,206,207,LBYTE},
	{128,129,132,133,136,137,140,141,LBYTE}, {130,131,134,135,138,139,142,143,LBYTE}, {192,193,196,197,200,201,204,205,HBYTE}, {194,195,198,199,202,203,206,207,HBYTE},

	// left back side subcard
	{82,83,86,87,90,91,94,95,LBYTE}, {80,81,84,85,88,89,92,93,LBYTE}, {18,19,22,23,26,27,30,31,HBYTE}, {16,17,20,21,24,25,28,29,HBYTE},
	{82,83,86,87,90,91,94,95,HBYTE}, {80,81,84,85,88,89,92,93,HBYTE}, {18,19,22,23,26,27,30,31,LBYTE}, {16,17,20,21,24,25,28,29,LBYTE},
	{210,211,214,215,218,219,222,223,LBYTE}, {208,209,212,213,216,217,220,221,LBYTE}, {146,147,150,151,154,155,158,159,HBYTE}, {144,145,148,149,152,153,156,157,HBYTE},
	{210,211,214,215,218,219,222,223,HBYTE}, {208,209,212,213,216,217,220,221,HBYTE}, {146,147,150,151,154,155,158,159,LBYTE}, {144,145,148,149,152,153,156,157,LBYTE},

	// right front side subcard
	{224,225,228,229,232,233,236,237,HBYTE}, {226,227,230,231,234,235,238,239,HBYTE}, {160,161,164,165,168,169,172,173,LBYTE}, {162,163,166,167,170,171,174,175,LBYTE},
	{224,225,228,229,232,233,236,237,LBYTE}, {226,227,230,231,234,235,238,239,LBYTE}, {160,161,164,165,168,169,172,173,HBYTE}, {162,163,166,167,170,171,174,175,HBYTE},
	{32,33,36,37,40,41,44,45,HBYTE}, {34,35,38,39,42,43,46,47,HBYTE}, {96,97,100,101,104,105,108,109,LBYTE}, {98,99,102,103,106,107,110,111,LBYTE},
	{32,33,36,37,40,41,44,45,LBYTE}, {34,35,38,39,42,43,46,47,LBYTE}, {96,97,100,101,104,105,108,109,HBYTE}, {98,99,102,103,106,107,110,111,HBYTE},

	// right back side subcard
	{178,179,182,183,186,187,190,191,LBYTE}, {176,177,180,181,184,185,188,189,LBYTE}, {242,243,246,247,250,251,254,255,HBYTE}, {240,241,244,245,248,249,252,253,HBYTE},
	{178,179,182,183,186,187,190,191,HBYTE}, {176,177,180,181,184,185,188,189,HBYTE}, {242,243,246,247,250,251,254,255,LBYTE}, {240,241,244,245,248,249,252,253,LBYTE},
	{114,115,118,119,122,123,126,127,LBYTE}, {112,113,116,117,120,121,124,125,LBYTE}, {50,51,54,55,58,59,62,63,HBYTE}, {48,49,52,53,56,57,60,61,HBYTE},
	{114,115,118,119,122,123,126,127,HBYTE}, {112,113,116,117,120,121,124,125,HBYTE}, {50,51,54,55,58,59,62,63,LBYTE}, {48,49,52,53,56,57,60,61,LBYTE},
};

const char *pkg_partRef_k7f_map[] = {
	// left front side subcard
	"u03", "u07", "u09", "u13",
	"u01", "u05", "u11", "u15",
	"u23", "u19", "u29", "u25",
	"u21", "u17", "u31", "u27",

	// left back side subcard
	"u14", "u10", "u08", "u04",
	"u16", "u12", "u06", "u02",
	"u26", "u30", "u20", "u24",
	"u28", "u32", "u18", "u22",

	// right front side subcard
	"u03", "u07", "u09", "u13",
	"u01", "u05", "u11", "u15",
	"u23", "u19", "u29", "u25",
	"u21", "u17", "u31", "u27",

	// right back side subcard
	"u14", "u10", "u08", "u04",
	"u16", "u12", "u06", "u02",
	"u26", "u30", "u20", "u24",
	"u28", "u32", "u18", "u22",
};
/************************************************************************************************************/

/*********************************************K7h_dual map BGA152-HH_0A**********************************/
const unsigned char dev_pkg_phylun_k7h_dual[][8+PKG_ATTR] = {
	// left front side subcard
	{0,1,2,3,8,9,10,11,LBYTE}, {0,1,2,3,8,9,10,11,HBYTE}, {16,17,18,19,24,25,26,27,LBYTE}, {16,17,18,19,24,25,26,27,HBYTE},
	{32,33,34,35,40,41,42,43,LBYTE}, {32,33,34,35,40,41,42,43,HBYTE}, {48,49,50,51,56,57,58,59,LBYTE}, {48,49,50,51,56,57,58,59,HBYTE},

	// left back side subcard
	{20,21,22,23,28,29,30,31,HBYTE}, {20,21,22,23,28,29,30,31,LBYTE}, {4,5,6,7,12,13,14,15,HBYTE}, {4,5,6,7,12,13,14,15,LBYTE},
	{52,53,54,55,60,61,62,63,HBYTE}, {52,53,54,55,60,61,62,63,LBYTE}, {36,37,38,39,44,45,46,47,HBYTE}, {36,37,38,39,44,45,46,47,LBYTE},

	// right front side subcard
	{64,65,66,67,72,73,74,75,LBYTE}, {64,65,66,67,72,73,74,75,HBYTE}, {80,81,82,83,88,89,90,91,LBYTE}, {80,81,82,83,88,89,90,91,HBYTE},
	{96,97,98,99,104,105,106,107,LBYTE}, {96,97,98,99,104,105,106,107,HBYTE}, {112,113,114,115,120,121,122,123,LBYTE}, {112,113,114,115,120,121,122,123,HBYTE},

	// right back side subcard
	{84,85,86,87,92,93,94,95,HBYTE}, {84,85,86,87,92,93,94,95,LBYTE}, {68,69,70,71,76,77,78,79,HBYTE}, {68,69,70,71,76,77,78,79,LBYTE},
	{116,117,118,119,124,125,126,127,HBYTE}, {116,117,118,119,124,125,126,127,LBYTE}, {100,101,102,103,108,109,110,111,HBYTE}, {100,101,102,103,108,109,110,111,LBYTE},
};

const char *pkg_partRef_k7h_dual_map[] = {
	// left front side subcard
	"u01", "u03", "u05", "u07",
	"u09", "u11", "u13", "u15",

	// left back side subcard
	"u08", "u06", "u04", "u02",
	"u16", "u14", "u12", "u10",

	// right front side subcard
	"u01", "u03", "u05", "u07",
	"u09", "u11", "u13", "u15",

	// right back side subcard
	"u08", "u06", "u04", "u02",
	"u16", "u14", "u12", "u10",
};
/************************************************************************************************************/

/*********************************************FIJI map fiji_0A**********************************/
const unsigned char dev_pkg_phylun_fiji[][8+PKG_ATTR] = {
	// left front side subcard
	{32,33,34,35,36,37,38,39,HBYTE}, {32,33,34,35,36,37,38,39,LBYTE},
	{16,17,18,19,20,21,22,23,HBYTE}, {16,17,18,19,20,21,22,23,LBYTE},
	{0,1,2,3,4,5,6,7,HBYTE}, {0,1,2,3,4,5,6,7,LBYTE},

	// left back side subcard
	{56,57,58,59,60,61,62,63,HBYTE}, {56,57,58,59,60,61,62,63,LBYTE},
	{72,73,74,75,76,77,78,79,HBYTE}, {72,73,74,75,76,77,78,79,LBYTE},
	{88,89,90,91,92,93,94,95,HBYTE}, {88,89,90,91,92,93,94,95,LBYTE},

	// right front side subcard
	{48,49,50,51,52,53,54,55,LBYTE}, {48,49,50,51,52,53,54,55,HBYTE},
	{64,65,66,67,68,69,70,71,LBYTE}, {64,65,66,67,68,69,70,71,HBYTE},
	{80,81,82,83,84,85,86,87,LBYTE}, {80,81,82,83,84,85,86,87,HBYTE},

	// right back side subcard
	{40,41,42,43,44,45,46,47,LBYTE}, {40,41,42,43,44,45,46,47,HBYTE},
	{24,25,26,27,28,29,30,31,LBYTE}, {24,25,26,27,28,29,30,31,HBYTE},
	{8,9,10,11,12,13,14,15,LBYTE}, {8,9,10,11,12,13,14,15,HBYTE},
};

const char *pkg_partRef_fiji_map[] = {
	// left front side subcard
	"u18", "u16",
	"u22", "u20",
	"u26", "u24",

	// left back side subcard
	"u13", "u11",
	"u09", "u07",
	"u05", "u03",

	// right front side subcard
	"u12", "u14",
	"u08", "u10",
	"u04", "u06",

	// right back side subcard
	"u15", "u17",
	"u19", "u21",
	"u23", "u25",
};
/************************************************************************************************************/

void config_dev_type(struct subcard_size *sc_size, int dev_type)
{
	switch(dev_type) {
	default:
	case K7F_MAP:
		sc_size->subcard_row = 4;
		sc_size->subcard_col = 4;
		sc_size->subcard_cnt = 4;
		break;
	case K7h_DUAL_MAP:
		sc_size->subcard_row = 2;
		sc_size->subcard_col = 4;
		sc_size->subcard_cnt = 4;
		break;
	case FIJI_MAP:
		sc_size->subcard_row = 3;
		sc_size->subcard_col = 2;
		sc_size->subcard_cnt = 4;
	}
}
